<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç®€æœ¬åœ°å°è¯´é˜…è¯»å™¨</title>
    <style>
        :root {
            --bg-color: #f4f1e7;
            --text-color: #333;
            --panel-bg: #e8e4d8;
            --font-size: 20px;
            --max-width: 800px;
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: "PingFang SC", "Microsoft YaHei", serif; background: var(--bg-color); color: var(--text-color); transition: all 0.3s; }

        /* å¼•å¯¼ç•Œé¢ */
        #drop-zone {
            height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 4px dashed #ccc; margin: 20px; border-radius: 20px;
        }
        textarea { width: 80%; height: 200px; margin: 20px 0; padding: 15px; border-radius: 10px; border: 1px solid #ddd; font-size: 14px; }
        .start-btn { padding: 15px 40px; background: #8b4513; color: white; border: none; border-radius: 30px; cursor: pointer; font-size: 18px; }

        /* é˜…è¯»ç•Œé¢å¸ƒå±€ */
        #reader-interface { display: none; }
        
        #sidebar {
            position: fixed; left: 0; top: 0; width: 300px; height: 100%; background: var(--panel-bg);
            transform: translateX(-100%); transition: transform 0.3s; z-index: 100; overflow-y: auto; padding: 20px; box-sizing: border-box;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        #sidebar.open { transform: translateX(0); }
        #sidebar h3 { border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 10px; }
        .toc-item { cursor: pointer; padding: 8px 0; font-size: 14px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .toc-item:hover { color: #8b4513; }

        #content-area { max-width: var(--max-width); margin: 0 auto; padding: 40px 20px; min-height: 100vh; }
        .chapter-title { font-size: 1.8em; color: #8b4513; margin-top: 60px; border-bottom: 2px solid #8b4513; padding-bottom: 10px; }
        p { text-indent: 2em; line-height: 1.8; margin: 1.5em 0; font-size: var(--font-size); text-align: justify; word-wrap: break-word; }

        /* æ§åˆ¶é¢æ¿ */
        #controls {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            padding: 10px 25px; border-radius: 50px; display: flex; gap: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1000; opacity: 0; transition: opacity 0.3s;
        }
        body:hover #controls { opacity: 1; }
        .control-btn { cursor: pointer; border: none; background: none; font-size: 14px; color: #555; }
        .control-btn:hover { color: #8b4513; }

        @media (max-width: 600px) { #sidebar { width: 80%; } #controls { gap: 10px; padding: 10px 15px; } }
    </style>
</head>
<body>

    <div id="drop-zone">
        <h1>ğŸ“– æç®€é˜…è¯»å™¨</h1>
        <p>ç²˜è´´å°è¯´æ–‡æœ¬å†…å®¹åˆ°ä¸‹æ–¹ï¼Œç‚¹å‡»â€œå¼€å§‹é˜…è¯»â€</p>
        <textarea id="text-input" placeholder="æ”¯æŒè¯†åˆ«ç±»ä¼¼ï¼šç¬¬ä¸€ç« ã€ç¬¬1ç« ã€åºç« ã€å·ä¸€..."></textarea>
        <button class="start-btn" onclick="processText()">å¼€å§‹æ²‰æµ¸é˜…è¯»</button>
    </div>

    <div id="reader-interface">
        <div id="sidebar">
            <h3>ç›®å½•</h3>
            <div id="toc-list"></div>
        </div>

        <div id="content-area">
            <div id="article-body"></div>
        </div>

        <div id="controls">
            <button class="control-btn" onclick="toggleSidebar()">ğŸ“‚ ç›®å½•</button>
            <button class="control-btn" onclick="changeFontSize(2)">A+</button>
            <button class="control-btn" onclick="changeFontSize(-2)">A-</button>
            <button class="control-btn" onclick="switchTheme('default')">ğŸ¨ é»˜è®¤</button>
            <button class="control-btn" onclick="switchTheme('eye')">ğŸƒ æŠ¤çœ¼</button>
            <button class="control-btn" onclick="switchTheme('dark')">ğŸŒ™ å¤œé—´</button>
            <button class="control-btn" onclick="location.reload()">ğŸ”„ é‡æ–°ä¸Šä¼ </button>
        </div>
    </div>

    <script>
        function processText() {
            const rawText = document.getElementById('text-input').value;
            if (!rawText.trim()) return alert("è¯·è¾“å…¥å†…å®¹");

            const lines = rawText.split('\n');
            const chapters = [];
            let currentChapter = { title: "å‰è¨€", paras: [] };

            // æ™ºèƒ½è¯†åˆ«ç« èŠ‚æ­£åˆ™ï¼šåŒ¹é… ç¬¬xxxç« , ç¬¬xxxèŠ‚, å·x, æ¥”å­ ç­‰
            const chapterRegex = /^\s*(ç¬¬[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾åƒä¸‡0-9]+[ç« èŠ‚å›å·])|^\s*(åºç« |æ¥”å­|å†…å®¹ç®€ä»‹|åè®°)\s*$/;

            lines.forEach(line => {
                const trimmed = line.trim();
                if (chapterRegex.test(trimmed) && trimmed.length < 30) {
                    if (currentChapter.paras.length > 0 || currentChapter.title !== "å‰è¨€") {
                        chapters.push(currentChapter);
                    }
                    currentChapter = { title: trimmed, paras: [] };
                } else if (trimmed) {
                    currentChapter.paras.push(trimmed);
                }
            });
            chapters.push(currentChapter);

            renderReader(chapters);
        }

        function renderReader(chapters) {
            document.getElementById('drop-zone').style.display = 'none';
            document.getElementById('reader-interface').style.display = 'block';

            const tocList = document.getElementById('toc-list');
            const articleBody = document.getElementById('article-body');

            chapters.forEach((ch, index) => {
                const id = `chapter-${index}`;
                
                // ç”Ÿæˆç›®å½•
                const tocItem = document.createElement('div');
                tocItem.className = 'toc-item';
                tocItem.innerText = ch.title;
                tocItem.onclick = () => {
                    document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
                    toggleSidebar();
                };
                tocList.appendChild(tocItem);

                // ç”Ÿæˆå†…å®¹
                const chDiv = document.createElement('div');
                chDiv.id = id;
                chDiv.innerHTML = `<h2 class="chapter-title">${ch.title}</h2>` + 
                                  ch.paras.map(p => `<p>${p}</p>`).join('');
                articleBody.appendChild(chDiv);
            });
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function changeFontSize(delta) {
            const root = document.documentElement;
            const currentSize = parseInt(getComputedStyle(root).getPropertyValue('--font-size'));
            root.style.setProperty('--font-size', (currentSize + delta) + 'px');
        }

        function switchTheme(type) {
            const root = document.documentElement;
            if (type === 'default') {
                root.style.setProperty('--bg-color', '#f4f1e7');
                root.style.setProperty('--text-color', '#333');
                root.style.setProperty('--panel-bg', '#e8e4d8');
            } else if (type === 'eye') {
                root.style.setProperty('--bg-color', '#c7edcc');
                root.style.setProperty('--text-color', '#222');
                root.style.setProperty('--panel-bg', '#b7dbbc');
            } else if (type === 'dark') {
                root.style.setProperty('--bg-color', '#1a1a1a');
                root.style.setProperty('--text-color', '#999');
                root.style.setProperty('--panel-bg', '#111');
            }
        }
    </script>
</body>
</html>
